<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cursor Position in Textarea</title>
        <style>
            #textarea-container {
                position: relative;
            }

            #textarea {
                font-size: 16px;
                padding: 10px;
            }

            .cursor-marker {
                position: absolute;
                z-index: 1;
                background-color: red; /* 예시로 배경색을 설정 */
                color: white; /* 텍스트 색상 설정 */
                width: 1px;
            }
        </style>
    </head>
    <body>
        <div id="textarea-container">
            <textarea id="textarea" autofocus rows="4" cols="50"></textarea>
            <span id="cursor-marker" class="cursor-marker">|</span>
        </div>

        <script>
            const textarea = document.getElementById('textarea');
            const cursorMarker = document.getElementById('cursor-marker');

            // textarea에 입력, 클릭, 스크롤 이벤트 리스너 추가
            textarea.addEventListener('input', updateCursorMarker);
            textarea.addEventListener('click', updateCursorMarker);
            textarea.addEventListener('scroll', updateCursorMarker);
            textarea.addEventListener('keydown', updateCursorMarker);
            // 초기 커서 위치 설정
            updateCursorMarker();

            function updateCursorMarker() {
                const cursorPosition = textarea.selectionEnd;
                console.log(cursorPosition);
                const textBeforeCursor = textarea.value.substring(
                    0,
                    cursorPosition
                );
                const linesBeforeCursor = textBeforeCursor.split('\n');
                const currentLineNumber = linesBeforeCursor.length - 1;
                const currentLineOffset =
                    linesBeforeCursor[currentLineNumber].length;

                // 계산된 커서 위치를 텍스트 너비로 변환
                const textWidthBeforeCursor = getTextWidth(
                    textBeforeCursor,
                    textarea
                );

                // 줄바꿈에 따른 높이 계산
                const lineHeight = parseFloat(
                    getComputedStyle(textarea).lineHeight
                );
                const topOffset = currentLineNumber * lineHeight;

                cursorMarker.style.left = `${textWidthBeforeCursor}px`;
                cursorMarker.style.top = `${topOffset}px`;
            }

            function getTextWidth(text, element) {
                const span = document.createElement('span');
                span.style.font = window.getComputedStyle(element).font;
                span.style.visibility = 'hidden';
                span.textContent = text;
                document.body.appendChild(span);
                const width = span.offsetWidth;
                console.log('asd', width);
                document.body.removeChild(span);
                return width;
            }
        </script>
    </body>
</html>
